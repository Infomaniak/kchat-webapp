resource_rules:
  # Issue Policies
  issues:
    rules:
      # Quick add to a weekly milestone
      - name: "Weekly Prioritization"
        conditions:
          state: opened
          milestone: none
          date:
            attribute: created_at
            condition: newer_than
            interval_type: days
            interval: 7
          forbidden_labels:
            - üíÄ stale
            - info
        actions:
          comment: |
            This issue has been added to the 'Weekly Tasks' milestone.
            Let's try to address it within the week.

            /milestone %"Weekly Tasks"
      - name: Copy metadata from merge request
        conditions:
          state: opened
          ruby: resource[:merge_requests_count] > 0
          labels:
            - bot-update-meta
        actions:
          remove_labels:
            - bot-update-meta
          comment: |
            /copy_metadata !#{resource[:related_merge_requests][0][:iid]}
      # Close stale issues
      - name: "Warn about close Stale Branches"
        conditions:
          state: opened
          date:
            attribute: updated_at
            condition: older_than
            interval_type: months
            interval: 1
          forbidden_labels:
            - üöß wip
            - üìù testing
            - info
        actions:
          comment: >
            This issue has been inactive for over a month. It will be closed as stale.
            If you would like to keep it open, please add a üöß wip or üìù testing tag and reopen.
          status: close
  # Merge Request Policies
  merge_requests:
    rules:
      # Update labels for trello tickets in merged MRs for schedule CI
      - name: "Update Trello for merged MRs"
        conditions:
          state: merged
          labels:
            - trello::To merge
        actions:
          remove_labels:
            - trello::To merge
          labels:
            - trello::To prod
      # Faster rebasing with labels
      - name: "Rebase stale"
        conditions:
          state: opened
          labels:
            - bot-rebase
        actions:
          remove_labels:
            - bot-rebase
          comment: |
            /rebase
